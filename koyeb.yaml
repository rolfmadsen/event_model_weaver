name: event-model-weaver

services:
  # Service 1: The React Frontend
  - name: frontend
    type: web
    instance_type: eNano # You can change this to 'free' or 'Micro'
    build_command: npm run build
    run_command: npm start
    ports:
      - port: 8000 # Use port 8000 as you specified
        protocol: http
        path: /
    health_checks:
      - port: 8000
        protocol: tcp # Simple TCP check for the 'serve' command

  # Service 2: The GUN.js Backend Relay (using Docker)
  - name: gun-relay
    type: web
    instance_type: eNano # You can change this to 'free' or 'Micro'
    docker:
      dockerfile: Dockerfile # Tell Koyeb to use the Dockerfile
    ports:
      - port: 8000 # Your server listens on $PORT (Koyeb sets this)
        protocol: http
        path: /gun # Traffic for /gun goes to this port
    health_checks:
      # We can now use the HTTP health check we built
      - port: 8000
        protocol: http
        path: /health

# Routing rules for your App
routes:
  # Send root traffic (/) to the frontend
  - path: /
    service: frontend
  # Send /gun traffic (including WebSockets) to the relay
  - path: /gun
    service: gun-relay